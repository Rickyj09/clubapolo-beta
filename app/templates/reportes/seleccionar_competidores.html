{% extends "base_admin.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h3 class="mb-0">Selección de competidores</h3>
    <small class="text-muted">{{ torneo.nombre }} — {{ torneo.fecha }}</small>
  </div>
  <a class="btn btn-outline-success"
     href="{{ url_for('reportes.torneo_seleccion_xlsx', torneo_id=torneo.id) }}">
    Exportar Excel seleccionados
  </a>
</div>

<form method="post">
     <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>✔</th>
          <th>Identificación</th>
          <th>Alumno</th>
          <th>Sucursal</th>
          <th>Modalidad</th>
        </tr>
      </thead>
      <tbody>
        {% for a in alumnos %}
          {% set mods = mapa.get(a.id, []) %}
          {% set checked = (mods|length) > 0 %}
          <tr>
            <td>
              <input class="form-check-input"
                     type="checkbox"
                     name="alumno_ids[]"
                     value="{{ a.id }}"
                     {% if checked %}checked{% endif %}>
            </td>
            <td>{{ a.numero_identidad or a.id }}</td>
            <td>{{ a.apellidos }} {{ a.nombres }}</td>
            <td>{{ a.sucursal.nombre if a.sucursal else "" }}</td>
            <td style="max-width:220px;">
              <select class="form-select" name="modalidad_{{ a.id }}">
                <option value="POOMSAE" {% if 'POOMSAE' in mods and 'COMBATE' not in mods %}selected{% endif %}>POOMSAE</option>
                <option value="COMBATE" {% if 'COMBATE' in mods and 'POOMSAE' not in mods %}selected{% endif %}>COMBATE</option>
                <option value="AMBAS" {% if 'POOMSAE' in mods and 'COMBATE' in mods %}selected{% endif %}>AMBAS</option>
              </select>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <button class="btn btn-primary" type="submit">Guardar selección</button>
</form>

{% endblock %}